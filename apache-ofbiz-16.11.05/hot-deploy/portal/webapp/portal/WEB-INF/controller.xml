<?xml version="1.0" encoding="UTF-8"?>
<site-conf xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		   xmlns="http://ofbiz.apache.org/Site-Conf" xsi:schemaLocation="http://ofbiz.apache.org/Site-Conf http://ofbiz.apache.org/dtds/site-conf.xsd">

	<include location="component://common/webcommon/WEB-INF/common-controller.xml" />
	<include location="component://commonext/webapp/WEB-INF/controller.xml" />
	<include location="component://content/webapp/content/WEB-INF/controller.xml" />

	<handler name="java" type="request"
		class="org.apache.ofbiz.webapp.event.JavaEventHandler" />
	<handler name="service" type="request"
		class="org.apache.ofbiz.webapp.event.ServiceEventHandler" />
	<handler name="service-multi" type="request"
		class="org.apache.ofbiz.webapp.event.ServiceMultiEventHandler" />
	<handler name="simple" type="request"
		class="org.apache.ofbiz.webapp.event.SimpleEventHandler" />

	<handler name="jsp" type="view" class="org.apache.ofbiz.webapp.view.JspViewHandler" />
	<handler name="http" type="view"
		class="org.apache.ofbiz.webapp.view.HttpViewHandler" />
	<handler name="screen" type="view"
	    class="org.apache.ofbiz.widget.renderer.macro.MacroScreenViewHandler"/>
	<handler name="simplecontent" type="view"
		class="org.apache.ofbiz.content.view.SimpleContentViewHandler" />
	<handler name="screenfop" type="view"
		class="org.apache.ofbiz.widget.renderer.fo.ScreenFopViewHandler" />

	<!-- Request Mappings -->
	<!-- default request; call into CMS -->
	<default-request request-uri="home" />

	<!-- Security Request Mappings -->
	<request-map uri="checkLogin" edit="false">
		<description>Verify a user is logged in.</description>
		<security https="true" auth="false"/>
		<event type="java" path="com.autopatt.portal.events.AutopattLoginWorker" invoke="extensionCheckLogin"/>
		<response name="success" type="view" value="main"/>
		<response name="error" type="view" value="login"/>
	</request-map>
	<request-map uri="login">
		<security https="true" auth="false" />
		<event type="java" path="com.autopatt.portal.events.AutopattLoginWorker" invoke="login" />
		<response name="success" type="request-redirect" value="home" />
		<response name="requirePasswordChange" type="view" value="requirePasswordChange" />
		<response name="error" type="view" value="login" />
	</request-map>
	<request-map uri="logout">
		<security https="true" auth="true" />
		<event type="java" path="org.apache.ofbiz.webapp.control.LoginWorker"
			invoke="logout" />
		<response name="success" type="request-redirect" value="home" />
		<response name="error" type="view" value="home" />
	</request-map>
	<request-map uri="autoLogout">
		<security https="true" auth="false" />
		<event type="java" path="org.apache.ofbiz.webapp.control.LoginWorker"
			invoke="autoLoginRemove" />
		<response name="success" type="request-redirect" value="home" />
		<response name="error" type="view" value="home" />
	</request-map>

	<!-- End of Security Mappings -->

	<request-map uri="home">
		<security https="true" auth="true" />
		<response name="success" type="view" value="home" />
	</request-map>

	<request-map uri="myaccount">
		<security https="true" auth="true" />
		<response name="success" type="view" value="myaccount" />
	</request-map>
	<request-map uri="UpdateMyProfile">
		<event type="java" path="com.autopatt.portal.events.MyProfileEvents" invoke="updateMyProfile" />
		<response name="success" type="request-redirect" value="myaccount" />
		<response name="error" type="request-redirect" value="myaccount" />
	</request-map>
	<request-map uri="changePassword">
		<security https="true" auth="true" />
		<response name="success" type="view" value="changePassword" />
	</request-map>

	<request-map uri="productAPC">
		<security https="true" auth="true" />
		<response name="success" type="view" value="productAPC" />
	</request-map>

	<request-map uri="manage_users">
		<security https="true" auth="true" />
		<response name="success" type="view" value="manage_users" />
	</request-map>
	<request-map uri="settings">
		<security https="true" auth="true" />
		<response name="success" type="view" value="settings" />
	</request-map>
	<request-map uri="users_list_section">
		<security https="true" auth="true" />
		<response name="success" type="view" value="users_list_section" />
	</request-map>
	<request-map uri="new_user">
		<security https="true" auth="true" />
		<response name="success" type="view" value="new_user" />
	</request-map>
	<request-map uri="requireChangePassword">
		<event type="java" path="com.autopatt.portal.events.AutopattLoginWorker" invoke="changePassword" />
		<response name="success" type="view" value="home" />
		<response name="error" type="view" value="requirePasswordChange" />
		<response name="requirePasswordChange" type="view" value="requirePasswordChange" />
	</request-map>

	<request-map uri="updatePassword">
		<security https="true" auth="true" />
		<event type="java" path="com.autopatt.portal.events.AutopattLoginWorker" invoke="updatePassword" />
		<response name="success" type="view" value="home" />
		<response name="error" type="view" value="changePassword" />
	</request-map>

	<request-map uri="CreateUser">
		<security https="true" auth="true" />
		<event type="java" path="com.autopatt.portal.events.UserMgmtEvents" invoke="createUser" />
		<response name="success" type="request-redirect" value="manage_users" >
			<redirect-parameter name="createSuccess"/>
		</response>
		<response name="error" type="view" value="new_user" />
	</request-map>
	<request-map uri="edit_user">
		<security https="true" auth="true" />
		<response name="success" type="view" value="edit_user" />
	</request-map>
	<request-map uri="initForgotPwd">
		<security https="true" auth="false" />
		<response name="success" type="view" value="initForgotPwd" />
	</request-map>
	<request-map uri="forgotPassword">
		<security https="true" auth="false" />
		<event type="java" path="com.autopatt.portal.events.PasswordMgmtEvents" invoke="sendPasswordResetLink" />
		<response name="success" type="view" value="forgotPwdInitiated"/>
		<response name="error" type="view" value="initForgotPwd" />
	</request-map>
	<request-map uri="spwd">
		<security https="true" auth="false" />
		<event type="java" path="com.autopatt.portal.events.PasswordMgmtEvents" invoke="validateJWTToken" />
		<response name="success" type="view" value="initResetPassword"/>
		<response name="error" type="view" value="resetPasswordResponse" />
	</request-map>
	<request-map uri="resetPassword">
		<security https="true" auth="false" />
		<event type="java" path="com.autopatt.portal.events.PasswordMgmtEvents" invoke="resetPassword" />
		<response name="success" type="view" value="resetPasswordResponse"/>
		<response name="error" type="view" value="initResetPassword" />
	</request-map>
	<request-map uri="UpdateUser">
		<event type="java" path="com.autopatt.portal.events.UserMgmtEvents" invoke="updateUser" />
		<response name="success" type="request-redirect" value="manage_users" >
			<redirect-parameter name="updateSuccess"/>
		</response>
		<response name="error" type="request-redirect" value="manage_users" />
	</request-map>
	<request-map uri="UpdateCompanyDetails">
		<event type="java" path="com.autopatt.portal.events.UserMgmtEvents" invoke="updateCompanyDetails" />
		<response name="success" type="request-redirect" value="settings" >
			<redirect-parameter name="updateSuccess"/>
		</response>
		<response name="error" type="request-redirect" value="settings" />
	</request-map>
	<request-map uri="DeleteUser">
		<event type="java" path="com.autopatt.portal.events.UserMgmtEvents" invoke="deleteUser" />
		<response name="success" type="request" value="json"/>
		<response name="error" type="request" value="json"/>
	</request-map>

	<!-- View Mappings - START -->
	<view-map name="home" type="screen"
		page="component://portal/widget/PortalScreens.xml#home" />

	<view-map name="login" type="screen"
			  page="component://portal/widget/PortalScreens.xml#login" />

	<view-map name="myaccount" type="screen"
			  page="component://portal/widget/PortalScreens.xml#myaccount" />

	<view-map name="changePassword" type="screen"
			  page="component://portal/widget/PortalScreens.xml#changePassword" />

			  
	<view-map name="productAPC" type="screen"
			  page="component://portal/widget/PortalScreens.xml#productAPC" />

	<view-map name="manage_users" type="screen"
			  page="component://portal/widget/PortalScreens.xml#manage_users" />
	<view-map name="settings" type="screen"
			  page="component://portal/widget/PortalScreens.xml#settings" />
	<view-map name="users_list_section" type="screen"
			  page="component://portal/widget/PortalScreens.xml#users_list_section" />

	<view-map name="requirePasswordChange" type="screen"
			  page="component://portal/widget/PortalScreens.xml#requirePasswordChange"/>
	<view-map name="new_user" type="screen"
			  page="component://portal/widget/PortalScreens.xml#new_user" />
	<view-map name="edit_user" type="screen"
			  page="component://portal/widget/PortalScreens.xml#edit_user" />
	<view-map name="initForgotPwd" type="screen"
			  page="component://portal/widget/PortalScreens.xml#initForgotPwd" />
	<view-map name="forgotPwdInitiated" type="screen"
			  page="component://portal/widget/PortalScreens.xml#forgotPwdInitiated" />
	<view-map name="initResetPassword" type="screen"
			  page="component://portal/widget/PortalScreens.xml#initResetPassword" />
	<view-map name="resetPasswordResponse" type="screen"
			  page="component://portal/widget/PortalScreens.xml#resetPasswordResponse" />
</site-conf>
